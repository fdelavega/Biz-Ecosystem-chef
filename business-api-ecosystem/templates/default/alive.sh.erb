#! /bin/bash

while true
do
  sleep 30
  exec 8<>/dev/tcp/localhost/<%= node[:biz][:charging][:port] %>

  if [[ $? -ne 0 ]]; then 
    nohup /opt/biz-ecosystem/virtenv/bin/python ./manage.py runserver 127.0.0.1:<%= node[:biz][:charging][:port] %> &
  fi

  exec 9<>/dev/tcp/localhost/<%= node[:biz][:port] %>

  if [[ $? -ne 0 ]]; then 
      nohup /usr/local/bin/node server.js &
  fi

  exec 8>&- # close output connection
  exec 8<&- # close input connection

  exec 9>&- # close output connection
  exec 9<&- # close input connection
done
